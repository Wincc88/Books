<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books Library</title>
    <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
    <div class="card-containers">

       <div class="addnewbookdiv">

            <button id="addbookbtn" type="button">Add New Book</button>

            <button id="allBooks" type="button">Books Total</button>

       </div>
            
       <div class="manualupload">

             
                    
                    <div class="displaybooks">

                            <table id="headingdetails">
                                    <thead>
            
                                      
                                    </thead>
                                    <tbody>

                                    </tbody>

                                    
                            </table>
 


                        
                    </div>

                    <!--- display books in divs, but now using table instead 
                    <div class="displaybooks1">
                        
                    </div>

                    <div class="displaybooks2">
                        
                    </div> 

                    <div class="displaybooks3">
                        
                    </div> 
                       -->
       </div>

                    <br>
            

                    <!---- new button pressed, brings this form, fill it put back with addBooktoLibrary()...etc -->
                    <!--- so it will be removed from here and added using DOM-->
                    
                    <div class="formbody">

                        <form name="book-form" form id="bookform">

                                <div class="top">
                                            
                                    <h1>Enter Book Details </h1>
                                    
                                 </div>

                                        
                                <div class="bookinfo">

                                                <div class="titleDiv">
                                                    <br>

                                                    <div>
                                                        <label for="book-title">Book Title: </label> 
                                                    
                                                        <input type="text" name="book-title" id="book-title" required />
                                                    </div>

                                                </div>
                                                <br>

                                                <div class="authorDiv">
                                                    <div>
                                                        <label for="book-author">Book Author: </label> 
                                                    
                                                        <input type="text" name="book-author" id="book-author" required />
                                                    </div>
                                                </div>
                                                <br>

                                                <div class="pagesDiv">
                                                    <div>
                                                        <label for="book-pages">Total pages: </label> 
                                                    
                                                        <input type="text" name="book-pages" id="book-pages" required />
                                                    </div>
                                                </div>
                                                <br>

                                                <div class="readDiv">
                                                
                                                    <div>
                                                        <label for="book-read">Have you read the book?</label> 
                                                         
                                                                <input type="radio" id="read" name="read_type" value="Read">
                                                                <label id="changeToUnread" for="read">Read</label>
                                                            
                                                                <input type="radio" id="unread" name="read_type" value="Unread" checked>
                                                                <label id="changeToRead" for="unread">Unread</label>
                                                              
                                                    </div>
                                                
                                                </div>
                                
                                <br>
                                                <div class="bookidDiv">
                                                    <div>
                                                        <label for="book-id">Book ID: </label>
                                                    
                                                        <input type="text" name="book-id" id="book-id">
                                                    </div>                                                            
                                                
                                                <br>
                                                <div>
                                                <button id="submitbtn" type="submit">Submit</button>
                                                <button id="closebtn" type="button">Close</button>
                                                </div>
                                </div>


                                        
                        </form>

                    </div>
          

    </div>

    <script>

        const myLibrary = [];
         
        const eachDisplay = document.querySelector(".displaybooks");
        
         
         class Book {
            constructor(title, author, pages, read, id) {
                if(!new.target) {
                    throw Error("'new' must be used to call constructor")
                }
                this.title = title;
                this.author = author;
                this.pages = pages;
                this.read = read;    
 
                this.id = crypto.randomUUID() + "**";
                
                this.info = function() {
                    // alert (`The ${this.title} by ${this.author}, ${this.pages} pages, ${this.read}, ${this.id}`);
                    return `The ${this.title} by ${this.author}, ${this.pages} pages, ${this.read}, ${this.id}`;
                };
 
            }
         }
         
 

         //  Book.prototype.readStatus = function () { }
         // this.read status of readtoggle needs to be updated  with prototype function.. later  
         
            

         function addBooktoLibrary(title, author, pages, read, id) {

           let tonew = new Book(title, author, pages, read, id);
            
            myLibrary.push(tonew);

            return myLibrary;    //return mylibrary instead of tonew to get all array

         }
            


       const cardContainer = document.querySelector(".card-containers");
       const formOPen = document.querySelector(".formbody");
       const addbookbutton = document.querySelector("#addbookbtn");
       const formid = document.querySelector('#bookform');
       const submitbutton = document.querySelector("#submitbtn");


       // now display in newdivs
       const manualTesting = document.querySelector(".manualupload");

     
        
       function openForm() {
        formOPen.style.display = "block";
       }     

       addbookbutton.addEventListener("click", openForm);

 
      Book.prototype.changeReadUnread = function(cell) {
            const readValue = document.querySelector('#read').value;
            const unreadValue = document.querySelector('#unread').value;
            if (cell.textContent === readValue) {
                cell.textContent = unreadValue;
                this.read = unreadValue;
            } else if (cell.textContent === unreadValue) {
                cell.textContent = readValue;
                this.read = readValue;
            }
      };


       function closeForm() {


        formOPen.style.display = "none";
       

                const divsfromForm = document.createElement('div');
                divsfromForm.classList.add('divsfromForm');

                const removebook = document.createElement('button');
                removebook.textContent = 'Remove book';
                removebook.id = 'removebtn';   

                const toggleReadUnread = document.createElement('button');
                toggleReadUnread.textContent = 'Toggle';
                toggleReadUnread.id = 'togglebtn';


                   // Create a table element inside the div created
                const tableInside = document.createElement('table');
                tableInside.id = 'tableInsideid';

                   // Create a table header (thead) element
                const thead = document.createElement('thead');

                  // create table row (tr) element
                const headerRow = document.createElement('tr'); 

                const headerNames = ['Title', 'Author', 'Pages', 'Read', 'Book-Id'];

                headerNames.forEach(headerText => {

                      // create <th> element
                    const theader = document.createElement('th');

                     
                    theader.textContent = headerText;

                      // add <th> to row 
                    headerRow.appendChild(theader);
                });

                    // Append tr(row) to thead
                thead.appendChild(headerRow);

                    // Append thead to table
                tableInside.appendChild(thead);

                    //Append table to container 
                divsfromForm.appendChild(tableInside);  

                

                   // variable to hold every last book entered in form
                const lastBookEntered = myLibrary[myLibrary.length -1];
                   // console.log(lastBookEntered);
                   
                   // create <tr> element for book details
                const bookRow = document.createElement('tr'); 

                // variable to hold book properties, here it is the keys we want
                const bookProperties =  ['title',  'author', 'pages', 'read', 'id']; 
                
               // console.log(lastBookEntered.read);

                for(i = 0; i < bookProperties.length; i++) {

                    //create new data cells for values to be gotten from the key;values pair
                     const cell = document.createElement('td');
                     //  console.log(cell);
                     
                     // lastBookEntered with corresponding bookProperties position @ [i] and text information inside
                    cell.textContent = lastBookEntered[bookProperties[i]];
                    // console.log(cell.textContent);
                    // console.log(lastBookEntered.read);
                      

                     //add cell to row -- bookRow
                    bookRow.appendChild(cell);
                      
                    // toggle function works inside with cell.textContent defined above and used here
                    // ... but we want to attach toggle to only the read cell...cell.textContent shows all cells(td)

                     if (bookProperties[i] === 'read') { 
                        toggleReadUnread.addEventListener("click", function() {
                            lastBookEntered.changeReadUnread(cell);
                         });
                        
                      }
                        
                    
                        
                       
                } 
 
                    // append row to table
                tableInside.appendChild(bookRow); 
 
                divsfromForm.appendChild(removebook);
                
                divsfromForm.appendChild(toggleReadUnread);

                   // append table to div
                manualTesting.appendChild(divsfromForm);
                    // cardContainer.appendChild(newDiv);   
               
                    
                    

                    // remove book with a click
                removebook.addEventListener("click", ()=> {

                    divsfromForm.remove();

                   // delete coresponding book from myLibrary array  'myLibrary.pop()' only removes last book added

                    const bookIndex = myLibrary.indexOf(lastBookEntered); 
                    if (bookIndex > -1) {
                        myLibrary.splice(bookIndex, 1);
                    }

                });
       

                  // after append everrything, we want to update the main table with the lastBookEntered read cell only
                  // toggle will need to be atached again 
                toggleReadUnread.addEventListener("click", function() {

                    // Update the read cell in the main table if it exists
                    const tableBody = document.querySelector("#headingdetails tbody");

                    // Find the row with the same id as book entered
                    // Assuming lastBookEntered.id is unique and corresponds to the Book-Id cell in the table
                    // We will find the row in the table body that matches the lastBookEntered.id
                    const rows = tableBody.querySelectorAll("tr");
                    for (let row of rows) {
                        // Assuming Book-Id is the 5th cell (index 4)
                        if (row.cells[4] && row.cells[4].textContent === lastBookEntered.id) {
                            // Update the read cell (index 3)
                            row.cells[3].textContent = lastBookEntered.read;
                        }
                    }
                });
                             
       } 
      
       const closeformbtn = document.querySelector('#closebtn');
       closeformbtn.addEventListener("click", closeForm); 


       
       function validateForm() {

        
            // get all the inputs within the submitted form
            let inputs = document.querySelectorAll('input');

            for (let i = 0; i < inputs.length; i++) {

                // only validate the inputs that have the required attribute
            
                if(inputs[i].hasAttribute("required")){


                    if(inputs[i].value === "" || inputs[i].value === null){

                        // found an empty field that is required

                        alert("Please fill all required fields");
                        inputs[i].focus();
                        return false;
                    }
                   
                }
            }
            return true;
       }

               // take value from form, put in addtolibrary function
         const titleinform = document.querySelector('#book-title');  // have to be separate to get value .value 
         const authorinform = document.querySelector('#book-author');
         const pagesinform = document.querySelector('#book-pages');
         const bookIsUnRead = document.querySelector('#unread');
         const readorunread = document.querySelector('#read'); 
         const idinform = document.querySelector('#book-id');
 
       
         let titlevalue;
         let authorvalue;
         let pagesvalue;
         let readtoggle;
         let idvalue;

       function submitform() { 

         event.preventDefault();     // click submit will repeat same input until click close
        
         if (!validateForm()) {
            return; // stop form submission if validation fails
         }
        
                // now use this for newdiv inputs 
                 titlevalue = `${titleinform.value}`;
                 authorvalue = `${authorinform.value}`; 
                 pagesvalue = pagesinform.value;    //use isNaN(pagevlue) to get a number if needed
                     
                    // Ensure pages is a number and prompt until valid
                    let pagesInput = pagesinform.value.trim();
                    while (isNaN(Number(pagesInput)) || pagesInput === "") {
                        pagesInput = prompt("Please enter a valid number for pages:");
                        if (pagesInput === null) return; // User cancelled
                    }
                 // Convert pagesInput to a number
                 pagesvalue = Number(pagesInput);

                 if (bookIsUnRead.checked) {
                     readtoggle = `${bookIsUnRead.value}`;
                 }
                 else if (readorunread.checked) {
                    readtoggle = `${readorunread.value}`;
              }

                 idvalue = `${idinform.value}`;

               // console.log(titlevalue);
              //  console.log(authorvalue);
              //  alert(idvalue);

         //cardContainer.textContent = titlevalue; 

          addBooktoLibrary(title = titlevalue, author = authorvalue, pages = pagesvalue, read = readtoggle, id = idvalue);
        // addBooktoLibrary(titlevalue, authorvalue, pagesvalue, readtoggle, idvalue); // correct and done here


          // console.log(myLibrary); // should be inside and not outside..shows all current books in library
          

          

         
         document.querySelector("#bookform").reset();

       }
       submitbutton.addEventListener("click", submitform);



        function displayTable() {
            
            eachDisplay.style.display = "block"; // show the displaybooks div
            
                //table to be added into
            const tableHeader = document.querySelector("#headingdetails thead"); 

                // avoid duplicate table headers by initializing it to an empty string to be added into only once
            tableHeader.textContent = '';

                // create row for table
            const headerRow = document.createElement('tr'); 
            
            
               // header names            
            const headerNames = ['Title', 'Author', 'Pages', 'Read', 'Book-Id'];

                    headerNames.forEach(headerText => {

                        // create <th> element for row
                        const theader = document.createElement('th');

                        theader.textContent = headerText;

                        // add <th> element to row
                        headerRow.appendChild(theader);                   

                    }); 

                    tableHeader.appendChild(headerRow);
                    
           
         
              // <tbody> table to add rows into
            const tableBody = document.querySelector("#headingdetails tbody"); 
                  
                 // avoid duplicate tbody rows by initializing it to an empty string to be added into 
             tableBody.textContent = '';  
            
                // cycle through the array for books in the library
              for (let i = 0; i < myLibrary.length; i++) {

                
                  //keep reference to each book object 
                const eachBookInLibrary = myLibrary[i]; //mylibrary[i] - each book now defined
                 // console.log(eachBookInLibrary); // shows each book object and their properties currently in the library

            
                  //create row element for each book to append cells into  
                 const rowIntbody = document.createElement('tr');
                  // console.log(rowIntbody);

                  // properties of library array elements
                 const mylibraryProperties = ['title', 'author', 'pages', 'read', 'id'];
                  // console.log(mylibraryProperties);


                 //append each property to the row in question, in order 
                 for(j = 0; j < mylibraryProperties.length; j++) {


                      //create new data cells <td> for values 
                    const cell = document.createElement('td');
                     //  console.log(cell);
                   
                     //set values of properties using bracket notation mylibraryProperties[j] is a string,
                     // and can be used to access eachBookLibrary properties
                    cell.textContent = eachBookInLibrary[mylibraryProperties[j]];
                     //  console.log(cell.textContent);
                     
                     //add cell to row in <tbody>
                    rowIntbody.appendChild(cell);
                 }
                   //add new row to <tbody>
                  tableBody.appendChild(rowIntbody);

                // eachDisplay.appendChild(tableBody); // better formatting when removed

               }

       }
        const displaybtn = document.querySelector('#allBooks');
        displaybtn.addEventListener("click", displayTable);

       
       
        
        

    </script>
    
</body>